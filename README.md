# VR DefenseGame
<div align="center">
  <a href="https://youtu.be/uO2vXkEGTrA">
    <img width="45%" height="45%" src="https://user-images.githubusercontent.com/60832219/209743804-2bdd21f6-2dcd-4433-bcd1-6208e44cda5f.png"/>
  </a>
</div>

## 🖥 프로젝트 소개
+ 모바일에서 실행되는 **VR 괴물 퇴치 게임**을 제작한다.
+ PC-VR이 아닌 **Mobile-VR**로 개발한다.
  
## 📌 프로젝트 목적
- VR과 기존의 다른 기술을 구분 짓는 특징은 몰입감과 상호작용성이 뛰어난 것에 있으며, 이러한 특징 덕분에 이미 교육, 의료, 관광 등 많은 분야에서 많이 사용되고 있다. 본 프로젝트를 진행하면서 VR 기법을 학습하고 적극적으로 응용해본다.

## ⏲ 프로젝트 기간
+ 소프트웨어 프로젝트I(2020.03 ~ 2020.06) : 팀 프로젝트
+ 소프트웨어 프로젝트II(2020.09 ~ 2020.12) : 팀 프로젝트

## ⚙ 개발 환경
- 소프트웨어
  - `Windows 10`
  - `Visual Studio 2019`
  - `Unity 2019.4.0f1`
  - `Oculus`
- 하드웨어
  - `Samsung Galaxy S10 5G`
  - `Samsung Gear VR`
<p align="center">
  <img width="50%" height="50%" src="https://user-images.githubusercontent.com/60832219/209739165-e94ec3be-6db3-4494-af8f-3ab907557680.png"/>
</p>

## 📈 플로우 차트
+ 모바일과 컨트롤러를 연결한 후, 프로그램을 실행하면 헤드 트래킹을 시작함과 동시에 컨트롤러를 사용할 수 있도록 초기화한다. 
+ 컨트롤러가 가리키는 방향으로 UI와 상호작용하여 게임을 시작할 수 있다. 
+ 게임이 시작되면 처치 수 초기화, 괴물의 체력 및 이동속도 초기화, 사용자의 체력이 초기화된다. 
+ 무작위 위치에 생성된 괴물은 사용자를 추적하고, 시간이 지나면서 괴물은 체력 및 이동 속도, 공격력이 점차 증가한다.
+ 사용자의 체력이 모두 소진되면 게임이 종료하게 된다.
<p align="center">
  <img width="60%" height="60%" src="https://user-images.githubusercontent.com/60832219/209739167-760c9471-3279-44f0-880e-aed7792536e2.png"/>
</p>
  
## 📝 클래스 다이어그램
- 본 프로젝트에서의 주요한 클래스는 열 가지이다.
- **Commander** 클래스는 게임 진행 상황을 총괄하는 클래스로써 클래스 대부분이 참조한다. 게임 상태, 괴물 처치 수, 사용자 체력을 다른 클래스가 참조할 수 있도록 해주고, Coroutine 함수를 통해 소환될 괴물의 체력, 공격력 및 이동속도를 점차 증가시키는 역할을 한다.
- **WeaponController** 클래스는 현재 사용하는 Weapon 클래스를 변수로써 담고, 총기의 위치 갱신 및 변경을 담당한다.
- **UIController** 클래스는 Canvas를 사용자 시야에 항상 유지하고, Commander 클래스와 WeaponController 클래스를 참조하여 사용자가 마주하는 UI 상의 이미지와 텍스트를 항시 갱신한다.
- **Pistol**, **Rifle**, **RocketLauncher** 클래스는 **Weapon** 클래스를 상속받는다. 따라서 탄창 수와 장전 시간 등을 관리하고, WeaponController 클래스에서 참조할 수 있도록 한다. 사격 방식에 따라 ShotGun 함수를 구성하고, 애니메이션, 소리 및 효과를 각자 지닌다. 이 때, ShotGun 함수는 적에게 데미지를 입히는 함수로써 Enemy 클래스의 Damaged 함수를 실행한다.
- **Zombie**, **AlienAnimal** 클래스는 **Enemy** 클래스를 상속받는다. 주요 변수는 체력, 공격력, 이동 속도가 있고, 주요 함수는 플레이어 추적, 애니메이션 처리가 있다.
<p align="center">
  <img width="75%" height="75%" src="https://user-images.githubusercontent.com/60832219/209739168-e62e58c8-0235-4627-9811-5e691c590399.png"/>
</p>

## 📋 프로젝트 구현
+ **지형 제작**
  + 지형을 제작하기 위해 Unity에서 제공하는 **Terrain** 기능을 중점적으로 사용하였다. Terrain 기능은 개발자로 뜻대로 지형의 높낮이와 재질을 지정할 수 있어서 매우 유용하다.
  + 괴물퇴치 게임에서는 제한된 영역에서 몰려드는 적을 처치하기에 적합한 **원형 콜로세움 형태**의 지형을 구성하고 재질을 칠하였다. 또한, 괴물이 특정 공간에서 즉시 생성되는 이질감을 제거하고자 오를 수 있는 **언덕**을 구성하였다.
  + 시야가 확 트이는 환경에서는 적을 탐색하는 것이 비교적 수월하므로 Tree 컴포넌트로 **나무 오브젝트와 풀 오브젝트를 곳곳에 배치**하여 난이도를 높였다. Terrain 기능으로 구성된 게임의 지형은 아래와 같다.
<p align="center">
  <img width="50%" height="50%" src="https://user-images.githubusercontent.com/60832219/209739169-1d684048-f7b8-44a7-985b-2ee3574681bb.png"/>
</p>

- **UI 제작**
  - 사용자에게 전체적인 게임 진행 상황을 보여주는 UI를 제작하기 위해 Unity 엔진의 Canvas 컴포넌트를 활용하였다. 초기 단계에서는 Text 컴포넌트와 Image 컴포넌트를 적절히 배치하였다. 이후, 사용자 시야에 항상 UI를 배치할 수 있도록 Canvas를 **World Space** 공간으로 위치하고, 오브젝트에 의해 가려지지 않도록 **UI 레이어만을 렌더링하는 카메라**를 두어 혼합하였다.
  - UI는 사용자의 체력, 괴물 처치 수, 게임 시작 및 종료 버튼, 게임 상태, 총기 장탄 수, 총기 유형을 나타낸다. 이는 아래의 그림과 같다.
<p align="center">
  <img width="50%" height="50%" src="https://user-images.githubusercontent.com/60832219/209739170-b9726122-54ba-4a85-84bc-fd3e72f2a57c.png"/>
</p>

+ **괴물 구현**
  + 3D 작업을 제외한 괴물을 구현하기 위한 단계는 경로 추적, 애니메이션, 음향으로 나누어진다.
  + 경로 추적은 **NavMeshAgent** 컴포넌트를 이용하였다. NavMeshAgent 컴포넌트를 사용하면 괴물이 다양한 장애물로 이루어진 맵에서 사용자에게 도달하기 위한 최단 경로를 찾아낼 수 있다. 다만, 괴물은 생성되고 나서 언덕을 올라야 하므로 허용 각도를 50°로 지정하였다.
  + 괴물의 애니메이션은 **BlendTree** 기능을 사용하였다. 괴물은 이동속도에 따라 정지, 걷기, 뛰기 애니메이션으로 변경되어야 하고, BlendTree 기능을 사용하면 이동속도 파라미터를 전달해 애니메이션의 실행 정도를 조절할 수 있다. 또한, 괴물이 사용자에게 어느 정도 접근하면 상체 레이어가 공격 애니메이션을 실행할 수 있도록 했다.
  + **음향**은 애니메이션과 밀접하게 연관되어 있으며, **애니메이션의 키 프레임**에 이벤트를 지정하면 원하는 시점에 음향을 실행할 수 있다. 뛰는 음향은 발이 지면에 닿는 순간에 실행하고, 공격 음향은 팔을 뻗는 순간에 실행되며, 죽는 음향은 죽음 애니메이션과 동시에 실행된다.
  + 아래의 그림은 괴물들의 모습을 나타낸 것이다.
<p align="center">
  <img width="30%" height="30%" src="https://user-images.githubusercontent.com/60832219/209739173-798b8dd2-f1df-40eb-9f29-80ebf5370006.png"/>
  <img width="30%" height="30%" src="https://user-images.githubusercontent.com/60832219/209739175-53f5591b-b945-42e1-b03a-b2c0f3e72edc.png"/>
</p>

- **총기 구현**
  - 총기의 종류는 총 세 가지로 나뉘며 **권총**, **기관단총**, **로켓 런처**로 구성된다. 모든 총기는 직접 **3D 모델링**을 통해 제작되었다.
  - 컨트롤러와 연동하여 총기 변경 및 사격을 할 수 있고, 컨트롤러의 트리거 버튼을 누를 때마다 각 총기 효과와 함께 사격 애니메이션을 재생한다. 사용자는 **LineRenderer** 컴포넌트를 활용한 레이저 포인터를 통해 총구가 가리키고 있는 지점을 파악할 수 있다. 만약, 보유한 탄창을 모두 소모할 경우 재장전 시간을 필요로 한다.
  - 최종적으로 컨트롤러를 통해서 괴물을 공격할 수 있을 뿐만 아니라 **UI를 조작**할 수 있도록 스크립트를 작성하였다.
  - 아래의 그림은 세 총기의 모습을 나타낸 것이다.
<p align="center">
  <img width="25%" height="25%" src="https://user-images.githubusercontent.com/60832219/209739177-fd134b8d-2a65-46fd-9ba9-754f1d3dbbad.jpeg"/>
  <img width="25%" height="25%" src="https://user-images.githubusercontent.com/60832219/209739180-57b68acb-26d2-4e1e-a238-161170e37e90.png"/>
  <img width="25%" height="25%" src="https://user-images.githubusercontent.com/60832219/209739182-e8fdc359-7bcc-4926-b132-f9d82daadfec.png"/>
</p>

+ **게임 진행 모듈 구현**
  + 본 게임에서는 게임의 시작과 종료를 담당하기 위해서 주로 **코루틴 함수**를 사용한다. 시작은 게임에 영향을 주는 변수들을 초기화하고 코루틴 함수를 실행한다. 실행과 동시에 지속해서 적을 생성하고, 생성 주기를 감소하며, 적의 체력과 이동속도를 증가시킨다. 종료하려면 단지 모든 코루틴 함수를 종료하면 된다. 이로써 게임의 시작과 종료를 계속해서 반복할 수 있다.

- **점수 저장 구현**
  - 모바일 내부 저장소에 최고 점수를 저장할 수 있도록 구현하였다. 최고 점수란 최대 괴물 처치 수를 의미하며, **Json** 확장자로 저장된다.
  - 게임이 시작되면 저장된 최고 점수를 불러오고 만약, 최고 기록을 경신했다면 해당 점수를 덮어쓴다.

+ **최적화**
  + 본 프로젝트에서 진행된 최적화 유형은 **스크립트 최적화**와 **렌더링 최적화**이다.
  + 스크립트 최적화는 흔히 사용하는 Update 함수가 아닌 코루틴 함수를 사용한 것에 있다. 코루틴 함수는 작업 순서를 정할 수 있다는 것이 특징인데, 이를 통해 함수 실행 빈도수를 반으로 줄였다. 또한, 스크립트에서 프레임마다 Text를 갱신하는 방식을 버리고, 값이 변경될 경우에만 갱신할 수 있도록 변경하였다. 이는 문자열의 갱신이 무거운 작업이기 때문에 행한 것이다.
  + 렌더링 최적화는 Unity 에디터 상에서 이루어졌다. 실시간 계산이 필요하지 않은 나무, 풀, 지형 등의 고정된 오브젝트를 Static 처리하였다. 그리고 대부분의 하드웨어에서 POT(:Power of Two) Texture만을 사용하므로 모든 Texture의 크기를 2의 거듭제곱 꼴로 수정했다.

## ✔ 프로젝트 평가
- 본 프로젝트에서는 애자일 개발 방법론의 **스크럼** 방식을 채용하여, 주기적인 테스트를 진행하였다. 지속적인 회의 및 테스트를 통하여 개발 진행하였으며, 프로그램 개발이 완료된 후 최종 테스트를 진행하였다. 다양한 측면에서 평가한 결과 요구사항을 만족하며 Mobile-VR 환경에서 실행됨을 확인하였다. 따라서 본 프로젝트는 **성공적**으로 수행한 것으로 평가된다.
- PC 플랫폼과는 달리 제약이 많았던 프로젝트였기에 모델링, 스크립팅 및 에디팅 과정에서 새로운 기법들을 적용했고, 그 과정에서 팀원들 모두 **성장**했다고 판단된다.
- 본인은 해당 프로젝트에서 Unity 엔진을 바탕으로 한 **프론트 엔드** 작업을 맡았다. 새롭게 제작된 UI를 Hierarchy에 적용하고, Low Poly 모델링을 직접 사용하기 위해서 **프리팹** 형태로 변형했다. Unity에서 과부하의 주요 요소인 **텍스처**와 **라이트**를 최적화하고, 시각 편의성을 개선한 UI를 World Canvas로 구현했다.
- 이번 프로젝트는 특별하게도 팀원들의 기술이 겹치지 않아서 **개발 외적**으로 많이 배울 수 있었고, 역할이 명확하게 구분되니 프로젝트 내내 편했다. 본인의 기여도는 네 명의 팀원이 동등하게 가져갔다고 생각하기에 **25**%이다.
<div align="center">
  <table border="0">
    <tr>
      <td align="center"><img width="100%" height="100%" src="https://user-images.githubusercontent.com/60832219/209739754-92829626-0674-49a7-93a0-3ae1d86666b6.jpg"/></td>
      <td align="center"><img width="100%" height="100%" src="https://user-images.githubusercontent.com/60832219/209739765-14bd237e-5da4-426e-a6e4-b633d522a066.jpg"/></td>
    </tr>
    <tr>
      <td colspan = "2" align="center">실제 구동 장면</td>
    </tr>
    <tr>
      <td colspan = "2" align="center"><img width="50%" height="50%" src="https://user-images.githubusercontent.com/60832219/209739769-228407ed-5559-4dfb-8682-70607b35b3c8.gif"/></td>
    </tr>
    <tr>
      <td colspan = "2" align="center">프리뷰</td>
    </tr>
  </table>
</div>
